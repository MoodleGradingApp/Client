<!--
-- Authors: Michael Sisko and Emily Costa
--
-- Citation(s):
-- Autosizing Textarea: https://stackoverflow.com/questions/2803880/ by Martin Prestone
--
-->

<head>
    <title>Grading Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<div class="panel panel-default hide-outline" id="master-panel">
    <p>Developed by: Emily Costa & Michael Sisko<br>Advised by: Victor Norman</p>
    <h1 class="title">Grading Assistant</h1>
    <div class="row">
        <div class="col fixed-panel" id="main-left-panel">
            <div class="panel panel-default hide-outline tight sticky">
                <div class="panel panel-default">
                    <div class="panel panel-default hide-outline tight" id="item-info">
                        <div id="assignment">
                            <label for="assignment">Assignment Name:&nbsp;</label>
                            <input
                            class="input-box"
                            type="text"
                            id="title"
                            name="assignment"
                            placeholder="Ex. Homework #1"
                            data-testid="nameInput"
                            >
                        </div>
                        <div id="max-pts">
                            <label for="max-pts">Max Points: {{maxScore}}</label>
                        </div>
                    </div>
                    <div class="panel panel-default hide-outline tight btn-set">
                        <button type="button" class="btn-primary-blue" (click)="previousStudent()" data-testid="prevStudentBtn">Prev Student</button>
                        <button type="button" class="btn-primary-blue" (click)="nextStudent()" data-testid="nextStudentBtn">Next Student</button>
                        <button type="button" class="btn-primary-blue" (click)="showChart = !showChart">{{ showChart ? "Hide Stats" : "Show Stats" }}</button>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div>
                        <label for="Student">Student Name: {{currentStudentName}}</label>
                    </div>
                    <div class="panel panel-default hide-outline tight btn-set">
                        <button type="button" id="save-btn" class="btn-primary-green" (click)="tempFunction()">Save Progress</button>
                        <button type="button" id="save-btn" class="btn-primary-green" (click)="perfectScore()">Perfect Score</button>
                        <button type="button" id="save-btn" class="btn-primary-green" (click)="clearScore()">Clear Score</button>
                    </div>
                    <br>
                    <div class="feedback-table-container">
                        <table id="feedback-table">
                            <thead>
                                <tr>
                                    <th id="trash-header">Delete</th>
                                    <th>Feedback</th>
                                    <th>Deduction</th>
                                    <th>Apply</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let dynamic of dynamicArray; let i = index;">
                                    <td (click)="deleteRow(i)">
                                        <button
                                            id="trash"
                                            data-testid="trashBtn">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <textarea
                                            class="input-box"
                                            id="feedback"
                                            data-testid="feedbackInput"
                                            placeholder="Say something constructive..."
                                            [(ngModel)]="dynamicArray[i].feedback"
                                            (ngModelChange)="onFeedbackChange($event, i)"
                                            type="text"
                                            name="text"
                                            oninput='this.style.height = "";
                                            this.style.height = this.scrollHeight + 3 + "px"'>
                                        </textarea>
                                    </td>
                                    <td>
                                        <input
                                            class="input-box"
                                            id="deduction"
                                            data-testid="deductionInput"
                                            placeholder="0"
                                            [(ngModel)]="dynamicArray[i].deduction"
                                            (ngModelChange)="onDeductionChange($event, i)"
                                            type="number"/>
                                    </td>
                                    <td>
                                        <input
                                            class="checkbox"
                                            id="checkbox{{i}}"
                                            data-testid="applyBtn"
                                            [(ngModel)]="dynamicArray[i].selected"
                                            (ngModelChange)="onSelectedChange($event, i)"
                                            type="checkbox"
                                            [attr.disabled]="isCheckDisabled ? true : null"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <br>
                    <button
                    type="button"
                    id="addFeedbackBtn"
                    class="btn-primary-blue"
                    (click)="addRow()"
                    data-testid="addFeedbackBtn"
                    >Add Feedback</button>
                    <br><br>
                </div>
            </div>
            <!-- Needs to be moved and restyled -->
            <div *ngIf="showChart" class="grade-stats">
                <apx-chart
                    [series]="chartOptions.series"
                    [chart]="chartOptions.chart"
                    [xaxis]="chartOptions.xaxis"
                    [yaxis]="chartOptions.yaxis"
                    [title]="chartOptions.title"
                ></apx-chart>
                <div class="feedback-stats">
                    <h4>Feedback Count:</h4>
                    <tbody>
                        <tr *ngFor="let stats of feedbackCount;">
                            <td class="feedback-count">{{stats.deduction}}:</td>
                            <td class="feedback-string">{{stats.feedback}}</td>
                        </tr>
                    </tbody>
                </div>
                <div class="class-stats">
                    <h4>Grade Stats:</h4>
                    <tbody>
                        <tr>
                            <td class="average-score">Average Score: {{averageScore}}</td>
                        </tr>
                        <tr>
                            <td class="min-score">Min Score: {{minScore}}</td>
                        </tr>
                        <tr>
                            <td class="max-score">Max Score: {{maxScoreStat}}</td>
                        </tr>
                    </tbody>
                </div>
            </div>
        </div>
    <div class="panel panel-default" id="main-right-panel">
        <div class="csv-import-btn">
    <div class="panel panel-default tight hide-outline sticky outer-nowrap">
        <label
            for="csvFileUpload"
            id="csvImportBtn"
            class="btn-primary-blue inner-nowrap"
            data-testid="importCSV"
        >Import Table</label>
        <input
            id="csvFileUpload"
            class="inner-nowrap sticky"
            type="file"
            #fileImportInput
            name="File Upload"
            accept=".csv"
            (change)="fileChangeListener($event)"/>
        <p *ngIf="validFile == false" class="file-warning inner-nowrap">*Invalid CSV File</p>
        <button
            type="button"
            class="btn-primary-blue"
            id="exportBtn"
            (click)="exportCSV()"
        >Export Table</button>
    </div>
    <div class="panel panel-default tight hide-outline csv-result-table">
        <table class="csvTable">
            <thead *ngIf="validFile == true">
                <tr>
                    <th class="narrow csv-table-head">#</th>
                    <th class="narrow csv-table-head">Name</th>
                    <th class="narrow csv-table-head">Email</th>
                    <th class="narrow csv-table-head">Timestamp</th>
                    <th class="narrow csv-table-head">Grade</th>
                    <th class="wide csv-table-head">Feedback</th>
                </tr>
            </thead>
            <tbody>
                <tr class="csv-data" *ngFor="let i = index; let csvData of csvRecords;"
                    (click)="rowSelected(i)" (click)="highlightRow(i)"
                >
                    <td class="narrow">{{i+1}}</td>
                    <td class="narrow">{{csvData.fullName}}</td>
                    <td class="narrow">{{csvData.email}}</td>
                    <td class="narrow">{{csvData.gradeLastModified}}</td>
                    <td>{{csvData.grade}}</td>
                    <td class="wide" id="feedback-column">{{feedbackStrings[i].strings.join('; ')}}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
